using CommunityToolkit.Maui.Views;
using ECOMap.API;
using ECOMap.Config;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Controls.Maps;
using Microsoft.Maui.Controls.Xaml;
using Microsoft.Maui.Maps;
using Newtonsoft.Json;
using System.Diagnostics;
using System.Text;
namespace ECOMap
{
    [XamlCompilation(XamlCompilationOptions.Compile)]
    public partial class MainPage : ContentPage
    {
        private HttpClient httpClient;

        public MainPage()
        {
            InitializeComponent();

            map.MoveToRegion(MapSpan.FromCenterAndRadius(new Location(51.74171, -2.21926),Distance.FromMiles(10)));
            NetworkAccess accessType = Connectivity.Current.NetworkAccess;
            try
            {
                if (accessType == NetworkAccess.Internet)
                {
                    LoadPolygonFromWeb();
                    SetMap();
                }
            }catch (Exception ex) 
            {
                Debug.WriteLine("Network error: "+ex.Message);
            }
            
      
        }
        
        public async void UpdatePins()
        {

            var treeDataList = await MauiProgram._ApiService.GetTreeDataAsync();

            foreach (var tree in treeDataList)
            {
                Pin pin = new Pin
                {
                    Label = tree.id.ToString(),
                    Type = PinType.SavedPin,
                    Location = new Location(tree.latitude, tree.longitude),
                };
                map.Pins.Add(pin);
            }

        }
        private async Task<bool> CheckPins()
        {
            try
            {
                var treeDataList = await MauiProgram._ApiService.GetTreeDataAsync();

                var tempList = treeDataList.Select(tree => new Pin
                {
                    Label = tree.id.ToString(),
                    Type = PinType.SavedPin,
                    Location = new Location(tree.longitude, tree.latitude),
                }).ToList();

                var currentPinsList = map.Pins.ToList();

                if (tempList.Count != currentPinsList.Count)
                    return false;

                foreach (var pin in currentPinsList)
                {
                    if (!tempList.Any(tempPin =>
                        tempPin.Location.Latitude == pin.Location.Latitude &&
                        tempPin.Location.Longitude == pin.Location.Longitude))
                    {
                        return false;
                    }
                }

                return true;
            }
            catch (Exception e)
            {
                Debug.WriteLine($"Error checking pins: {e.Message}");
                return false;
            }
        }

        private async void SetMap()
        {
            PermissionStatus result = await CheckAndRequestLocationPermission();

            if (result == PermissionStatus.Granted)
            {
                var locationRequest = new GeolocationRequest(GeolocationAccuracy.High, TimeSpan.FromSeconds(2));
                Location? location = await Geolocation.GetLocationAsync(locationRequest);

                if (location != null)
                {
                    map.IsVisible = true;

                    map.MoveToRegion(MapSpan.FromCenterAndRadius(location, Distance.FromMiles(1)));
                }
                else
                {
                    await DisplayAlert("Can't detect your current location", "Try restarting the app", "OK");
                }

                var treeDataList = await MauiProgram._ApiService.GetTreeDataAsync();
                foreach (var treeData in treeDataList)
                {
                    CustomPin pin = new CustomPin
                    {
                        Label = treeData.id.ToString(),
                        Address = "",
                        ImageSource = "treeinfo.png",
                        treedata = treeData,
                        Location = new Location(treeData.latitude, treeData.longitude),
                        
                    };

                    pin.MarkerClicked += Pin_InfoWindowClicked;
                    map.Pins.Add(pin);
                }
            }
        }


        private async void Pin_InfoWindowClicked(object sender, PinClickedEventArgs e)
        {
            e.HideInfoWindow = true;
            CustomPin pin = (CustomPin)sender;
            ShowCustomPopup(pin.treedata);
            

     
           
        }
        private void ShowCustomPopup(treeData treeData)
        {
            var popup = new CustomPopup(treeData,this);
            this.ShowPopup(popup);  
        }

        private async void LoadPolygonFromWeb()
        {
            try
            {
              
                string stringResult = "{ \"type\": \"Polygon\", \"coordinates\": [ [ [ -2.010215369699301, 51.902924424887999 ], [ -2.010373705854589, 51.902538712684283 ], [ -2.010433353803727, 51.902409182189004 ], [ -2.010495758656204, 51.902279742205224 ], [ -2.010681783411108, 51.901937171541327 ], [ -2.010831377166632, 51.901609884547383 ], [ -2.010957749503524, 51.901387765821674 ], [ -2.01103332192273, 51.901216975958867 ], [ -2.011166843461238, 51.90084645553295 ], [ -2.011406634305858, 51.900397814083426 ], [ -2.011533011560879, 51.900218840588998 ], [ -2.011839561194166, 51.8998322140894 ], [ -2.011995045524811, 51.899618271709969 ], [ -2.012140351840418, 51.899435699971768 ], [ -2.012363980121814, 51.899092225584063 ], [ -2.012480273151435, 51.898870107789634 ], [ -2.012625437392344, 51.898628211689889 ], [ -2.012670445897174, 51.898466414605146 ], [ -2.012680582291911, 51.898298238767836 ], [ -2.012664573331946, 51.898050158965965 ], [ -2.012661542856711, 51.897510671782726 ], [ -2.012607618229514, 51.897088039724352 ], [ -2.012449130166594, 51.896806719039645 ], [ -2.012325506615607, 51.896509124946981 ], [ -2.012129238375508, 51.896090103900953 ], [ -2.01184414661692, 51.895520984805351 ], [ -2.011942986746743, 51.895474234204322 ], [ -2.011932692351918, 51.895075956367798 ], [ -2.011958891412094, 51.894922250735824 ], [ -2.012089511430721, 51.894546338926382 ], [ -2.01211272705023, 51.894442968140787 ], [ -2.012205667268052, 51.894301838967856 ], [ -2.012417711550875, 51.893760530161209 ], [ -2.01257021519167, 51.893263270349166 ], [ -2.012593390587068, 51.893025972423679 ], [ -2.01261216563184, 51.892900041688293 ], [ -2.012741493216302, 51.89265095601602 ], [ -2.012795238206857, 51.892476572963226 ], [ -2.012949092235631, 51.892117825805329 ], [ -2.012976728958654, 51.891980209945871 ], [ -2.013008517935102, 51.89169967723241 ], [ -2.01311604065006, 51.891465965186185 ], [ -2.013267039123043, 51.8911872164324 ], [ -2.013816083136097, 51.890263768591673 ], [ -2.013994768330319, 51.890048832602744 ], [ -2.014026737216013, 51.889987707761072 ], [ -2.014410052329582, 51.889405028510204 ], [ -2.014540807843186, 51.889183806823603 ], [ -2.014845776698517, 51.888657853268775 ], [ -2.015367110700856, 51.88781260055358 ], [ -2.015648801246051, 51.887236223682024 ], [ -2.015777981176992, 51.886998820508893 ], [ -2.015859384636327, 51.886827130235183 ], [ -2.016040879691505, 51.886493543423121 ], [ -2.016422866896532, 51.886039392744188 ], [ -2.016527368186063, 51.88582095792534 ], [ -2.016660965040274, 51.885563779123373 ], [ -2.016702969542022, 51.885443238510767 ], [ -2.016718973397527, 51.885313802459464 ], [ -2.016675321733037, 51.885187970797041 ], [ -2.016357035908006, 51.88487692789505 ], [ -2.015996567373631, 51.884506476677601 ], [ -2.015907878831128, 51.88438874036683 ], [ -2.01583664073413, 51.884157658144616 ], [ -2.015303498379776, 51.884296244385972 ], [ -2.01489085253578, 51.884407756411342 ], [ -2.015094192430935, 51.884205399873984 ], [ -2.015448530565919, 51.883844824441709 ], [ -2.0155153471984, 51.8837702113753 ], [ -2.015573539598472, 51.883696498660186 ], [ -2.015602501786869, 51.883619193604439 ], [ -2.01560978150409, 51.883538207062159 ], [ -2.015577770984514, 51.883460012316128 ], [ -2.015493381032884, 51.883294637318471 ], [ -2.015493374477692, 51.883275671704737 ], [ -2.015493353351894, 51.883214549992552 ], [ -2.015459891824646, 51.883094109397511 ], [ -2.015333383240475, 51.88271113000561 ], [ -2.015330484988881, 51.882643627768033 ], [ -2.015349403597002, 51.88261755845982 ], [ -2.015459674144738, 51.882462942094556 ], [ -2.015496051089657, 51.882352380111492 ], [ -2.015612053963257, 51.881807485012693 ], [ -2.015764445969892, 51.881542215605506 ], [ -2.015905322532356, 51.881231106110654 ], [ -2.016082540779515, 51.881060210413352 ], [ -2.016284336078852, 51.880954118031745 ], [ -2.016330871528954, 51.880790521776746 ], [ -2.016384480574373, 51.880643912967876 ], [ -2.016478946496547, 51.880527947572851 ], [ -2.016680840855499, 51.880376823069 ], [ -2.016975608383907, 51.880021646018626 ], [ -2.017173064871188, 51.879862520255756 ], [ -2.017196268415517, 51.879776138348831 ], [ -2.017277578671036, 51.879723992466829 ], [ -2.017953040120608, 51.879486502829984 ], [ -2.018000927818147, 51.87942807076378 ], [ -2.018034322240089, 51.879367842795219 ], [ -2.0181155966471, 51.879231205147704 ], [ -2.018230392659019, 51.879056721537921 ], [ -2.018234701039612, 51.87904863073323 ], [ -2.018283986874739, 51.878894022409526 ], [ -2.018424911531081, 51.878766273166832 ], [ -2.018594793640353, 51.878572005303589 ], [ -2.018596231816214, 51.878572005065443 ], [ -2.01888527626163, 51.878344549153397 ], [ -2.019174206767772, 51.878139474734496 ], [ -2.019363029792748, 51.87799382943404 ], [ -2.019500947150223, 51.877849001847103 ], [ -2.019617091151285, 51.87776449046315 ], [ -2.019789972925431, 51.877603477101808 ], [ -2.019849468684177, 51.877531559241767 ], [ -2.020017885616277, 51.877297740728402 ], [ -2.020283524688495, 51.876994692593293 ], [ -2.020370699477835, 51.876952431701405 ], [ -2.020409857659967, 51.876934447088558 ], [ -2.020542020497426, 51.876793304672958 ], [ -2.020546434406242, 51.876753755113647 ], [ -2.020552146243104, 51.876674565753014 ], [ -2.020817883568871, 51.876339158569252 ], [ -2.020884590187521, 51.876327461507181 ], [ -2.021016804479554, 51.876303167492267 ], [ -2.021109726312421, 51.876260005862676 ], [ -2.021140264850989, 51.876253708230323 ], [ -2.021391533713111, 51.876236582416645 ], [ -2.021510666580633, 51.87615476493125 ], [ -2.02181721411326, 51.876271555967868 ], [ -2.021930467449347, 51.876171762560169 ], [ -2.022104655972318, 51.876015240020585 ], [ -2.022165593711186, 51.87572481116284 ], [ -2.022168459989408, 51.87570773306954 ], [ -2.022200431639355, 51.875692446560876 ], [ -2.022312266483417, 51.875636695520832 ], [ -2.02235583348387, 51.875579161500909 ], [ -2.022319390379832, 51.875511754987421 ], [ -2.022291817859143, 51.875457829635948 ], [ -2.022365913522274, 51.875375930183857 ], [ -2.022431149711286, 51.875303111569053 ], [ -2.022574773320161, 51.87487154728921 ], [ -2.022686464084315, 51.874532570659291 ], [ -2.02277051730651, 51.874252024029872 ], [ -2.022789384618397, 51.874143170435552 ], [ -2.02279667000811, 51.874101821959208 ], [ -2.022812590544908, 51.874085639405983 ], [ -2.02289830097436, 51.874007422677145 ], [ -2.023084066230235, 51.873794268945588 ], [ -2.023055024019307, 51.873678323960085 ], [ -2.023130364331391, 51.87346339439614 ], [ -2.023143369199382, 51.873368114778529 ], [ -2.023176741505634, 51.873289907636369 ], [ -2.023227555570733, 51.873124420155186 ], [ -2.02331315087643, 51.873058786976607 ], [ -2.023258015831586, 51.872971610577601 ], [ -2.023278192809623, 51.872851070984758 ], [ -2.023516236074722, 51.87254352701877 ], [ -2.023532258469131, 51.872493188347974 ], [ -2.023546724174683, 51.872446445508416 ], [ -2.023703487775593, 51.872216218345116 ], [ -2.023717964632592, 51.872188351235074 ], [ -2.023736875383095, 51.872167674214801 ], [ -2.023768830655623, 51.872129916006941 ], [ -2.023877647802116, 51.872046299989066 ], [ -2.023945873202212, 51.871976176291135 ], [ -2.023992413737978, 51.871891585193559 ], [ -2.023982222713564, 51.871869116084731 ], [ -2.023932700403036, 51.871752276509461 ], [ -2.024028613248356, 51.871727088545263 ], [ -2.02414045147742, 51.871697402500736 ], [ -2.024147577913645, 51.871587652049847 ], [ -2.024149001369408, 51.871563383174681 ], [ -2.024186831610334, 51.871540004743181 ], [ -2.024246332243168, 51.871504937832768 ], [ -2.024260787665958, 51.871438420044122 ], [ -2.024272378318885, 51.871389879520066 ], [ -2.024302908740288, 51.871375491839132 ], [ -2.024391505822838, 51.871334035889163 ], [ -2.024475671295956, 51.871289974330793 ], [ -2.024535262008408, 51.871202773699345 ], [ -2.024559840248558, 51.871034683876665 ], [ -2.024654120153603, 51.870874579138501 ], [ -2.024654076260451, 51.870794582403306 ], [ -2.024654046669411, 51.870740651544608 ], [ -2.024713520126853, 51.87065875374973 ], [ -2.024793337952022, 51.870550874613023 ], [ -2.024793320593563, 51.870519415019452 ], [ -2.024793313650187, 51.87050683118197 ], [ -2.024627768840097, 51.870427769569993 ], [ -2.024616051230511, 51.870243418323405 ], [ -2.024589597821413, 51.869828966523599 ], [ -2.024492227872654, 51.869587108277116 ], [ -2.024364385572293, 51.869464892888956 ], [ -2.024304717533139, 51.869408188485039 ], [ -2.024160983031682, 51.869346199072766 ], [ -2.02414780633654, 51.869339909956807 ], [ -2.024147801022743, 51.869330022525062 ], [ -2.024147775420209, 51.869282383571331 ], [ -2.024083877777552, 51.86915116591107 ], [ -2.024062060409881, 51.869108834487548 ], [ -2.024011141483989, 51.869063903622454 ], [ -2.023955903820085, 51.869000996086214 ], [ -2.023948665648491, 51.86890122597336 ], [ -2.023905035802135, 51.868824743103296 ], [ -2.023909287659158, 51.868714184025954 ], [ -2.023917905112225, 51.86848039298556 ], [ -2.023994831365889, 51.86834644817408 ], [ -2.024000563533773, 51.868315886453992 ], [ -2.02403244850298, 51.868152199817359 ], [ -2.024065838524218, 51.868114441207609 ], [ -2.024138398499666, 51.867876141938346 ], [ -2.024189016151385, 51.86758760182164 ], [ -2.024238243775021, 51.86738885628769 ], [ -2.02425568679743, 51.867314248588691 ], [ -2.024502383762499, 51.866911332735597 ], [ -2.024663453501875, 51.866714450965205 ], [ -2.024786830080355, 51.866570519086117 ], [ -2.02499437417954, 51.866402389030256 ], [ -2.025194645032062, 51.866081366846224 ], [ -2.025214952457586, 51.86599318550887 ], [ -2.02522797095702, 51.865933858901265 ], [ -2.025258478188573, 51.865885314951122 ], [ -2.025347006388942, 51.865742378331788 ], [ -2.025358556842689, 51.865627233914786 ], [ -2.025372976349248, 51.865505885942568 ], [ -2.025391896162876, 51.865504983519756 ], [ -2.025415124385407, 51.865503180129835 ], [ -2.025412109385185, 51.865464531055636 ], [ -2.025401959926826, 51.865303549797275 ], [ -2.025427985832685, 51.865166918963951 ], [ -2.025466971388583, 51.864868403486689 ], [ -2.025494553028188, 51.86472808775801 ], [ -2.0254523202254, 51.864579787420887 ], [ -2.025533562831251, 51.864473705620085 ], [ -2.025539422764541, 51.864461120456781 ], [ -2.025404294887267, 51.86434960431847 ], [ -2.02527641216741, 51.864347834562949 ], [ -2.025251711406505, 51.864284020787359 ], [ -2.025309782646229, 51.864282210590048 ], [ -2.025972045395557, 51.864264084893563 ], [ -2.026231996590329, 51.864264025379825 ], [ -2.026387416907331, 51.864263989523216 ], [ -2.026701137012837, 51.864275601265327 ], [ -2.0269479394415, 51.864311497482248 ], [ -2.027299450677491, 51.864440936947929 ], [ -2.027534805825983, 51.864554135047833 ], [ -2.02770622119715, 51.864665550892063 ], [ -2.027930063148763, 51.864937037155748 ], [ -2.028036195002618, 51.8650053240939 ], [ -2.028364339072913, 51.864904572331284 ], [ -2.028473163848187, 51.864873983858338 ], [ -2.028795564281234, 51.864783119766919 ], [ -2.029165815878351, 51.864623840656549 ], [ -2.029518624646951, 51.864528472224066 ], [ -2.030309998471813, 51.864380764870205 ], [ -2.030712149692929, 51.864306053775429 ], [ -2.030972073887095, 51.864266434963049 ], [ -2.031728653412883, 51.864199713284762 ], [ -2.032687137660202, 51.864174276432252 ], [ -2.033084998512218, 51.864136410891881 ], [ -2.033371154598328, 51.864112867769876 ], [ -2.03387070404965, 51.864117216098172 ], [ -2.034272903847503, 51.864117096779111 ], [ -2.034637542676829, 51.864165614464838 ], [ -2.035031043396112, 51.864220325970543 ], [ -2.03552486516164, 51.86424624254358 ], [ -2.035826964884611, 51.864246149635314 ], [ -2.035924203229077, 51.86426139980788 ], [ -2.036542901385956, 51.864272891331446 ], [ -2.036602258504849, 51.864084924298695 ], [ -2.036634103639803, 51.863932110926818 ], [ -2.036868858024137, 51.863284688340748 ], [ -2.037102004148863, 51.86243853084256 ], [ -2.037077214390808, 51.862287532705238 ], [ -2.037037683405603, 51.861973758550455 ], [ -2.03699098539765, 51.861679761509485 ], [ -2.037233317250126, 51.861528588076112 ], [ -2.037815396175099, 51.861181355408057 ], [ -2.038025890312215, 51.861049156374378 ], [ -2.038117312441373, 51.860988903621994 ], [ -2.038218925241226, 51.860943838684555 ], [ -2.038523675029092, 51.860708240585645 ], [ -2.03883424670248, 51.860564232237003 ], [ -2.039175332399885, 51.860403224244635 ], [ -2.039583173012384, 51.860183678053332 ], [ -2.039847442948433, 51.860083815246881 ], [ -2.040246620789263, 51.859957749433157 ], [ -2.040754724906764, 51.859808364579493 ], [ -2.041034954699931, 51.859753436062981 ], [ -2.041830427904288, 51.859507678810864 ], [ -2.041959748849597, 51.85952560889735 ], [ -2.042282008130863, 51.859480549681507 ], [ -2.042685662425155, 51.859417483095832 ], [ -2.043157565139617, 51.859360591847313 ], [ -2.043404364430842, 51.859282300615952 ], [ -2.043600343805692, 51.859272339932978 ], [ -2.044424907795303, 51.859046328239621 ], [ -2.045484692460248, 51.858794242267813 ], [ -2.045941936138704, 51.858694201421265 ], [ -2.04607693407702, 51.858645611031712 ], [ -2.04654857598454, 51.858348714854614 ], [ -2.047254213302069, 51.858341239809832 ], [ -2.04727744031782, 51.85834123038844 ], [ -2.048116844460585, 51.858368750851781 ], [ -2.04833472527524, 51.85846762377593 ], [ -2.048567092681786, 51.858563703036779 ], [ -2.049403836844652, 51.858889721370431 ], [ -2.049634898031888, 51.8589929902896 ], [ -2.05024793344875, 51.859249887938951 ], [ -2.050461538371243, 51.859371139392195 ], [ -2.050721655447731, 51.859541897264613 ], [ -2.051088045103213, 51.859989451450261 ], [ -2.051179501770434, 51.85997682749705 ], [ -2.052018555945316, 51.859673458500943 ], [ -2.052181286688257, 51.859796617349822 ], [ -2.05263038450669, 51.860107507437938 ], [ -2.053169528779074, 51.860524418529451 ], [ -2.053556253266223, 51.860827243933748 ], [ -2.053807670843276, 51.861016875577953 ], [ -2.054075012448668, 51.861204611231734 ], [ -2.054412243292056, 51.861461614884611 ], [ -2.05457204988057, 51.861532549159648 ], [ -2.054916544327809, 51.861751796481876 ], [ -2.055192600207539, 51.861910763199973 ], [ -2.055374247336047, 51.862019527485216 ], [ -2.055455747932207, 51.862086003683913 ], [ -2.055659377625082, 51.862348459403634 ], [ -2.055999668568663, 51.862741182522349 ], [ -2.056168250422464, 51.862930848382376 ], [ -2.056227919486121, 51.862963178500522 ], [ -2.056431319910339, 51.86303588662652 ], [ -2.056704419979595, 51.863119348203647 ], [ -2.056938396640231, 51.86322538834159 ], [ -2.057321921903233, 51.863422947468614 ], [ -2.05756612579646, 51.863565833692491 ], [ -2.058209985250727, 51.863965592096363 ], [ -2.058406120370285, 51.864061670675902 ], [ -2.058518032586768, 51.864121029367432 ], [ -2.058865339589811, 51.864264670634405 ], [ -2.059051272706058, 51.864340978411576 ], [ -2.059365122692321, 51.864443378863228 ], [ -2.059555443049796, 51.864485527687776 ], [ -2.059832824920461, 51.864536621106957 ], [ -2.059918587107776, 51.864558149520235 ], [ -2.060156812092119, 51.864606565730092 ], [ -2.060808960249918, 51.864643082355911 ], [ -2.061567097342985, 51.864693022779228 ], [ -2.061946077832378, 51.864697318191048 ], [ -2.062278663982323, 51.864661188263632 ], [ -2.062512477018016, 51.864634099191726 ], [ -2.06300021854977, 51.864494517742294 ], [ -2.063241181957613, 51.864443153986144 ], [ -2.063466272478262, 51.864430448826504 ], [ -2.063862749629845, 51.864446413328118 ], [ -2.064407267206297, 51.864409173921793 ], [ -2.064784894811696, 51.864390090637926 ], [ -2.065531333354115, 51.864382485759563 ], [ -2.065874040850408, 51.864393080652874 ], [ -2.066148538393627, 51.864431665973385 ], [ -2.066745606044985, 51.864547278966874 ], [ -2.067527250190307, 51.864779722578923 ], [ -2.067692917098115, 51.864823670551345 ], [ -2.067909386244498, 51.864890060134101 ], [ -2.068356729008156, 51.864965303452252 ], [ -2.068622593972452, 51.864993012409514 ], [ -2.068766407166893, 51.864996524695023 ], [ -2.069216646538776, 51.865006147621983 ], [ -2.069716232044506, 51.865024727841067 ], [ -2.070713911552583, 51.865026827828018 ], [ -2.070757496982819, 51.865026801579809 ], [ -2.070793872295932, 51.865086193033854 ], [ -2.071033674551107, 51.865214582567525 ], [ -2.071163117169831, 51.865291805156687 ], [ -2.071279486323714, 51.865431144399473 ], [ -2.071283950257701, 51.865528216516282 ], [ -2.071247787280606, 51.865602843001255 ], [ -2.071250833467567, 51.865711690577676 ], [ -2.071211743609672, 51.865753959353171 ], [ -2.070994195411763, 51.865920377631738 ], [ -2.070804269039388, 51.866139899428809 ], [ -2.070792766480788, 51.866211813604501 ], [ -2.070741960862673, 51.866266673076794 ], [ -2.070660794560981, 51.86635579748107 ], [ -2.070349111798468, 51.86666887107318 ], [ -2.070050212164399, 51.866889266089629 ], [ -2.069935706454712, 51.867025149543899 ], [ -2.069889433183517, 51.867146520369758 ], [ -2.069763534176445, 51.867425326525002 ], [ -2.069723025401827, 51.867558378483615 ], [ -2.069713137329539, 51.867745433666983 ], [ -2.069684297772513, 51.867835334548786 ], [ -2.069669957421622, 51.868008909489085 ], [ -2.069635211068263, 51.868073646306811 ], [ -2.069626722722388, 51.86823733038208 ], [ -2.069552970223105, 51.868400064153249 ], [ -2.069534113983555, 51.86844232125901 ], [ -2.069493731293808, 51.868579058467091 ], [ -2.069461825121499, 51.868623120589092 ], [ -2.069432786282657, 51.86866178821473 ], [ -2.069351645054325, 51.868771494730204 ], [ -2.069203576612125, 51.868812929011717 ], [ -2.069211089789348, 51.868947840566094 ], [ -2.069397444905222, 51.869273200393302 ], [ -2.069422176460405, 51.869313633482939 ], [ -2.069438340699978, 51.869389126576444 ], [ -2.069464478243189, 51.869409784957789 ], [ -2.069491360156397, 51.869430903230018 ], [ -2.069458668160818, 51.869418904355157 ], [ -2.069445594940774, 51.869417923090346 ], [ -2.069396214379652, 51.869418851422807 ], [ -2.069326500071976, 51.869419791758048 ], [ -2.069234998221674, 51.869419845820147 ], [ -2.069226283759725, 51.869419850965215 ], [ -2.069178361134931, 51.869424374738344 ], [ -2.06901599378667, 51.869432382481271 ], [ -2.068951972591837, 51.869546785441585 ], [ -2.068937471878593, 51.869562078638161 ], [ -2.068889677165669, 51.869650218357009 ], [ -2.068855038026869, 51.869793195323687 ], [ -2.068818888448615, 51.869898411041703 ], [ -2.068814551808561, 51.869911900060679 ], [ -2.068808765490507, 51.869927188126837 ], [ -2.068768391771281, 51.870119618834956 ], [ -2.068759821522092, 51.870214029172566 ], [ -2.068705211376815, 51.87059527882014 ], [ -2.068672092014911, 51.870783209743529 ], [ -2.068659256035658, 51.870937862140863 ], [ -2.068626005875681, 51.871040378805077 ], [ -2.068604368437363, 51.871138393169716 ], [ -2.068592895448843, 51.871234603382518 ], [ -2.068565426017725, 51.871318235585044 ], [ -2.068565434243045, 51.871323630168611 ], [ -2.068566922359449, 51.871347005847213 ], [ -2.06858444939967, 51.871410831547827 ], [ -2.068565711163656, 51.871505247813111 ], [ -2.068559978013695, 51.871555600659249 ], [ -2.068558653014388, 51.871639217551312 ], [ -2.068526772377771, 51.871687787503021 ], [ -2.068515310039617, 51.871791190481439 ], [ -2.068486405429899, 51.871886511778186 ], [ -2.06848352098685, 51.871899999935167 ], [ -2.068483581234248, 51.87193956021185 ], [ -2.068456159067686, 51.872054660789722 ], [ -2.068422624082912, 51.872161762961419 ], [ -2.068395449593553, 51.872248901433267 ], [ -2.068389798198336, 51.872353200098765 ], [ -2.068365264151797, 51.872457509791602 ], [ -2.068334818817774, 51.872590863793569 ], [ -2.068301775702068, 51.872735368117425 ], [ -2.06830033957047, 51.872746158130575 ], [ -2.068287363837452, 51.872810001654258 ], [ -2.068287430738839, 51.872854057413029 ], [ -2.068265731618512, 51.872912511436077 ], [ -2.068257962228303, 51.872961426893838 ], [ -2.068257098355125, 51.87296646234595 ], [ -2.068229559015673, 51.873005139614946 ], [ -2.067971399478168, 51.873263330833566 ], [ -2.067823513957671, 51.873444135116522 ], [ -2.067748131079478, 51.873543079450521 ], [ -2.067704636120565, 51.873597050439038 ], [ -2.067546573710271, 51.87377327485035 ], [ -2.067447965187102, 51.873883111451001 ], [ -2.067443614278439, 51.873887609442477 ], [ -2.067384155365257, 51.873951479568881 ], [ -2.067378787264718, 51.873955716504902 ], [ -2.067396945507769, 51.873956597077552 ], [ -2.067433521926082, 51.873937964726956 ], [ -2.067479999543821, 51.873935240701151 ], [ -2.067620902490499, 51.873938755938319 ], [ -2.067840250058004, 51.873946721147817 ], [ -2.067982596106403, 51.873943941432024 ], [ -2.067955170166773, 51.87405814274782 ], [ -2.067933538027114, 51.874161551526434 ], [ -2.067900168132936, 51.874283578420133 ], [ -2.067932272903932, 51.874285627752833 ], [ -2.067943866027114, 51.874286725129046 ], [ -2.067905202199743, 51.874495817421092 ], [ -2.067865576485707, 51.87472421208129 ], [ -2.067872091481086, 51.874966852300027 ], [ -2.067884664891872, 51.87514859042026 ], [ -2.067869376853835, 51.875204740725074 ], [ -2.067736645743427, 51.87536943506273 ], [ -2.067580114311063, 51.875553649873098 ], [ -2.067517954834916, 51.875634303332376 ], [ -2.067543473738962, 51.875724949206223 ], [ -2.06756219543715, 51.875906208310965 ], [ -2.067550767399934, 51.875974727079459 ], [ -2.067515595486872, 51.875973025567482 ], [ -2.067483058061923, 51.875973853489981 ], [ -2.067483060892846, 51.875975741594601 ], [ -2.067444577856433, 51.876468019996082 ], [ -2.067371567546691, 51.877185542264165 ], [ -2.067370705373866, 51.877191836446066 ], [ -2.067373030970814, 51.877192734207277 ], [ -2.067378844290561, 51.877194529061462 ], [ -2.067375990124209, 51.877228696427785 ], [ -2.06736450074445, 51.877316814639279 ], [ -2.067342708140341, 51.877315028967324 ], [ -2.067308321632146, 51.877634228513287 ], [ -2.067295250281216, 51.877636034216053 ], [ -2.067296761569784, 51.877675234020138 ], [ -2.067296503974162, 51.877677832561218 ], [ -2.067295330945703, 51.877689980048487 ], [ -2.067319725305956, 51.877682917109517 ], [ -2.067319885032701, 51.877682872062863 ], [ -2.067338892297955, 51.877677367653952 ], [ -2.067401339709205, 51.877665643480675 ], [ -2.068028721454887, 51.877551095539637 ], [ -2.068014368682528, 51.877666188402387 ], [ -2.067977005234965, 51.877935040347801 ], [ -2.067958615782922, 51.878070724879827 ], [ -2.067957611257357, 51.878078907252771 ], [ -2.067947109051683, 51.87815636163058 ], [ -2.067943962765493, 51.878179614124818 ], [ -2.067942711673318, 51.878216927410023 ], [ -2.067938730977045, 51.878245583965594 ], [ -2.067932220978809, 51.878292421745094 ], [ -2.067912820248815, 51.878432008933956 ], [ -2.067899322789869, 51.878536671738587 ], [ -2.06789469978487, 51.878553667365459 ], [ -2.067888776804707, 51.878575608783095 ], [ -2.067873607238211, 51.878631181813631 ], [ -2.06768042645044, 51.878553791329608 ], [ -2.067619084661374, 51.878528652007326 ], [ -2.067603094159382, 51.878521468451808 ], [ -2.067530432199812, 51.878503528396031 ], [ -2.067364758571399, 51.878459567969493 ], [ -2.067127880353761, 51.878400363458894 ], [ -2.066895358163672, 51.878339357784697 ], [ -2.066803803757563, 51.878316033473489 ], [ -2.066768924452339, 51.878306163277202 ], [ -2.06669771452804, 51.878287322777425 ], [ -2.066626507325289, 51.878270280428531 ], [ -2.066556924407759, 51.878369220750471 ], [ -2.066456040720163, 51.878520865928898 ], [ -2.066436327942772, 51.878550637250378 ], [ -2.066433718789405, 51.878554504850996 ], [ -2.066390523021174, 51.878618724928877 ], [ -2.066313407639067, 51.878733043949467 ], [ -2.066370230603683, 51.878748026707655 ], [ -2.066398278724319, 51.878755383417612 ], [ -2.066593889735622, 51.878807060430638 ], [ -2.066769739796292, 51.878855691446674 ], [ -2.066836592645594, 51.878874624291505 ], [ -2.067112576817051, 51.878951159564792 ], [ -2.067163878799448, 51.878965335910721 ], [ -2.067195270305308, 51.878973949249136 ], [ -2.067319092651954, 51.879008043881086 ], [ -2.06736370702284, 51.879018717500337 ], [ -2.067353279900708, 51.879040391751438 ], [ -2.06735258852847, 51.879063768690678 ], [ -2.067357865240255, 51.879163062012552 ], [ -2.067362305060077, 51.879246729495094 ], [ -2.067364565568709, 51.879301123607647 ], [ -2.067363920709417, 51.879452621942512 ], [ -2.067363933898791, 51.879461433092359 ], [ -2.067363464108377, 51.879535788741542 ], [ -2.067363011621065, 51.879718755377866 ], [ -2.067381138249585, 51.879793999425722 ], [ -2.067403212391782, 51.879885964413965 ], [ -2.067413015269566, 51.879932352210034 ], [ -2.06740470367571, 51.87993497246817 ], [ -2.067532087985811, 51.880612806064661 ], [ -2.067921428800357, 51.881518880981837 ], [ -2.068056492563096, 51.881506479535702 ], [ -2.068219324922582, 51.881488492134594 ], [ -2.068376206262083, 51.881474194302228 ], [ -2.068401192447626, 51.881472830969223 ], [ -2.068405525719957, 51.881551859062654 ], [ -2.068825074511197, 51.881603813194907 ], [ -2.068776287538025, 51.881726317039217 ], [ -2.068826826153421, 51.881732688719346 ], [ -2.06880873762787, 51.881779542372236 ], [ -2.068776913829763, 51.881869920438099 ], [ -2.068898097105308, 51.88188180671041 ], [ -2.068887244333679, 51.881910134691189 ], [ -2.068808526827054, 51.882116703849988 ], [ -2.068923312428519, 51.882124727751041 ], [ -2.06899959473759, 51.882130526647408 ], [ -2.069080234854384, 51.882135873357107 ], [ -2.069234571465049, 51.882165991232917 ], [ -2.069324763443701, 51.882182276790637 ], [ -2.069185019770286, 51.882285926061705 ], [ -2.068886093321421, 51.882483039000945 ], [ -2.068780244739055, 51.882590063624697 ], [ -2.068684495230231, 51.882721440527042 ], [ -2.068636853250547, 51.882900337698217 ], [ -2.068626918575222, 51.883062224155424 ], [ -2.068598190244337, 51.88331220891849 ], [ -2.068598509542391, 51.883521638044932 ], [ -2.068599237566362, 51.883999100874497 ], [ -2.068637904728821, 51.884531370479124 ], [ -2.06874583624965, 51.884834302725622 ], [ -2.068852624663624, 51.885269369291166 ], [ -2.068873183718694, 51.885474381418618 ], [ -2.068882061086722, 51.885560665033168 ], [ -2.06888683141609, 51.885780967535347 ], [ -2.068878501830375, 51.88605242103673 ], [ -2.068873077978665, 51.886343738311261 ], [ -2.068844724256635, 51.8867600964454 ], [ -2.068807053918736, 51.886882360651427 ], [ -2.068701468062974, 51.887167444422239 ], [ -2.068585699498173, 51.887454332293359 ], [ -2.068517640090526, 51.887603580002001 ], [ -2.068392932148143, 51.887764634702719 ], [ -2.068316026251181, 51.887848272444366 ], [ -2.068151876940314, 51.887913983978414 ], [ -2.068037241005281, 51.88800312629084 ], [ -2.067892239114197, 51.888212639590478 ], [ -2.06782553272302, 51.888308045370046 ], [ -2.067641226896525, 51.888433090544368 ], [ -2.067429360200353, 51.888636440071778 ], [ -2.06724669453253, 51.888899005702754 ], [ -2.067188812124516, 51.889048336481515 ], [ -2.067151252237273, 51.889167903584401 ], [ -2.067132644153749, 51.889382825890024 ], [ -2.067132911211875, 51.88956178431485 ], [ -2.067142154993157, 51.889895337853453 ], [ -2.067142413910902, 51.890068813585614 ], [ -2.067203722872874, 51.890287286217472 ], [ -2.067192575204157, 51.890604671340995 ], [ -2.067155584445707, 51.891106334527677 ], [ -2.066991828941306, 51.891444571124339 ], [ -2.066784610812778, 51.891401102833782 ], [ -2.066639267039288, 51.891391194389911 ], [ -2.06640393411801, 51.891367064841916 ], [ -2.066182452206738, 51.891348635308844 ], [ -2.066004826498678, 51.891348736049338 ], [ -2.06587336577258, 51.891367365959965 ], [ -2.065814660003555, 51.89132472178138 ], [ -2.065733223148092, 51.89128197081601 ], [ -2.064952309824649, 51.890872061556273 ], [ -2.064838481253114, 51.890937579089901 ], [ -2.064806262961872, 51.890965738699258 ], [ -2.064804231080711, 51.890967448110587 ], [ -2.064672357718864, 51.891014993611741 ], [ -2.064663242345131, 51.891019001443389 ], [ -2.064627840839326, 51.890998086541607 ], [ -2.064522443511043, 51.890961034776417 ], [ -2.064400867501893, 51.890901630449086 ], [ -2.064283893070086, 51.890834611708925 ], [ -2.064128248474495, 51.890744657521125 ], [ -2.064047457376345, 51.890707590873504 ], [ -2.063941253985617, 51.890643420485461 ], [ -2.063835024572819, 51.890560694471127 ], [ -2.063666479632258, 51.890455164475888 ], [ -2.063546418629248, 51.890378154998373 ], [ -2.06338945584548, 51.890305447860257 ], [ -2.063283228250833, 51.89022272041727 ], [ -2.063116983352562, 51.890110053117326 ], [ -2.063013066745113, 51.890030178793047 ], [ -2.062879159547165, 51.889947466819933 ], [ -2.062819112416541, 51.889896115844984 ], [ -2.062786746311824, 51.889844749931939 ], [ -2.062740579655741, 51.889821937742369 ], [ -2.062498224579731, 51.889716446581311 ], [ -2.062478851948496, 51.889726616753727 ], [ -2.062431163973738, 51.889706772271644 ], [ -2.062279888636056, 51.889593387217175 ], [ -2.062189558717323, 51.889605590320578 ], [ -2.062183794663507, 51.889594189255824 ], [ -2.061502683998024, 51.889846226595154 ], [ -2.061415505822453, 51.889876023670865 ], [ -2.061215166713505, 51.889946238825758 ], [ -2.060994366700644, 51.890037137289347 ], [ -2.060966793608766, 51.890024567960282 ], [ -2.06071987637021, 51.890116378678471 ], [ -2.060172252922337, 51.890306408183257 ], [ -2.060075034004542, 51.890354995205627 ], [ -2.060090987700846, 51.890369368931673 ], [ -2.060075072399774, 51.89038375819549 ], [ -2.060066338292465, 51.890392750971309 ], [ -2.059992386575598, 51.890459303372197 ], [ -2.05979213231748, 51.890687801243907 ], [ -2.059710941002121, 51.890807388630108 ], [ -2.059658765719976, 51.890944129357955 ], [ -2.059619933843127, 51.891205800842982 ], [ -2.059605407493648, 51.891274120766042 ], [ -2.059568400392614, 51.891828004068422 ], [ -2.059525132779636, 51.892087881376341 ], [ -2.059491882985457, 51.892220926839556 ], [ -2.059408021094742, 51.8924970051768 ], [ -2.059318432815578, 51.892882746390278 ], [ -2.059076279283948, 51.893329775165263 ], [ -2.058947345780502, 51.893593202291839 ], [ -2.058763193749464, 51.893962901517853 ], [ -2.058563210586239, 51.894321731984327 ], [ -2.058503727219787, 51.89446467796995 ], [ -2.058442896440098, 51.894584345026047 ], [ -2.058361748161303, 51.894744380294611 ], [ -2.058318308595606, 51.894878329794679 ], [ -2.058164444361359, 51.895051075154441 ], [ -2.058004890238892, 51.895271462133032 ], [ -2.057929548562416, 51.895383855234783 ], [ -2.057743892561064, 51.895713015775378 ], [ -2.057669946195389, 51.89579394750691 ], [ -2.057540270676551, 51.895883419521958 ], [ -2.057338600609008, 51.896036957484867 ], [ -2.057196477629669, 51.896151213654321 ], [ -2.057115851071107, 51.896246409009109 ], [ -2.056917787240053, 51.896215580713509 ], [ -2.056633180373752, 51.896162194469149 ], [ -2.056129345636212, 51.896063715802377 ], [ -2.055480019601093, 51.895940717700121 ], [ -2.055192260332537, 51.895887823054174 ], [ -2.05504237940625, 51.895860538098681 ], [ -2.054998795627179, 51.895902720414483 ], [ -2.054646844300677, 51.896283387233382 ], [ -2.05447108415792, 51.896473540335499 ], [ -2.054407078555365, 51.896542711419052 ], [ -2.054292127467316, 51.896665492883983 ], [ -2.054101995295258, 51.896871026841005 ], [ -2.054086031345745, 51.896889465905502 ], [ -2.05401927370728, 51.89696726945914 ], [ -2.054006216826849, 51.896986156710952 ], [ -2.05397357240805, 51.897031576628486 ], [ -2.053964142231643, 51.897045067567532 ], [ -2.053951956634602, 51.897063414946054 ], [ -2.053933679846055, 51.897092284665916 ], [ -2.053911920418011, 51.897125561608583 ], [ -2.05384449065616, 51.89724921965248 ], [ -2.053796636962841, 51.897336904442611 ], [ -2.053731393550317, 51.897466405580424 ], [ -2.053688620073783, 51.897549142904417 ], [ -2.053643670233873, 51.897635028081723 ], [ -2.053613162936974, 51.897693897499238 ], [ -2.053565371870434, 51.897786113648458 ], [ -2.053532014816087, 51.897844121222391 ], [ -2.053538556394802, 51.897845466857028 ], [ -2.053534495905212, 51.897852841379645 ], [ -2.053526230234787, 51.897868129953324 ], [ -2.053507088156782, 51.897903113910395 ], [ -2.053421819735977, 51.898059956860649 ], [ -2.053414550926336, 51.898058162003188 ], [ -2.05335219004369, 51.898169229985527 ], [ -2.053282577678276, 51.898293338267401 ], [ -2.053227473230134, 51.898396310918542 ], [ -2.053223850032607, 51.89840485406414 ], [ -2.053218772954862, 51.898412948325507 ], [ -2.053210791325315, 51.898422842126806 ], [ -2.053202805950082, 51.898429589067575 ], [ -2.053197721916672, 51.898431839159478 ], [ -2.053191909606926, 51.898432740930367 ], [ -2.053185370624576, 51.898433643034409 ], [ -2.053212268195944, 51.89844262172241 ], [ -2.053169490149524, 51.898523111103302 ], [ -2.053164123340444, 51.89853201468825 ], [ -2.053162528397021, 51.898535162281547 ], [ -2.053097713235796, 51.898661156371709 ], [ -2.053083937327416, 51.898687236679095 ], [ -2.05306798403834, 51.898715565740297 ], [ -2.053062181819399, 51.898725008982041 ], [ -2.053056380131125, 51.898734901774937 ], [ -2.053045501825421, 51.898753338372977 ], [ -2.053017938687145, 51.898796058394389 ], [ -2.052997629505061, 51.898827985852286 ], [ -2.052987472507188, 51.898841926598571 ], [ -2.052957000411232, 51.898882849729475 ], [ -2.052946697307359, 51.898896161166761 ], [ -2.052902873138511, 51.89895309442317 ], [ -2.052831465209673, 51.899035664688697 ], [ -2.052819273614122, 51.899049786169137 ], [ -2.052741334231069, 51.899140001736747 ], [ -2.052740173232664, 51.899141440830547 ], [ -2.052721737817065, 51.899160420301172 ], [ -2.052701705480297, 51.899180928971013 ], [ -2.052681673230978, 51.899201527547852 ], [ -2.052669479637435, 51.899214030628102 ], [ -2.052661205375336, 51.899222485960692 ], [ -2.052639575755615, 51.899244254090902 ], [ -2.052618526723328, 51.899265392581221 ], [ -2.052598348848995, 51.899285811389667 ], [ -2.052546234549973, 51.899338432584173 ], [ -2.052404537084006, 51.899468147473485 ], [ -2.052320469323167, 51.899539034819938 ], [ -2.052274744030804, 51.899587157494175 ], [ -2.052266760196132, 51.899595522758254 ], [ -2.052175299529839, 51.899683406392235 ], [ -2.0520897396576, 51.899771628962007 ], [ -2.052078039392077, 51.899783700190888 ], [ -2.052072223220925, 51.899781455047979 ], [ -2.051963358475216, 51.899901534244833 ], [ -2.051960760024585, 51.899904223729806 ], [ -2.051957334131673, 51.899907767734184 ], [ -2.051875533512332, 51.899992383060656 ], [ -2.051683913272516, 51.900189821939293 ], [ -2.051646172250426, 51.900230927804351 ], [ -2.051642543204536, 51.900234795567599 ], [ -2.051610213586173, 51.900267472610899 ], [ -2.050118976571489, 51.899842533760335 ], [ -2.04827400293415, 51.899262482771988 ], [ -2.047774052990203, 51.899082472852356 ], [ -2.047745478106845, 51.899153040885693 ], [ -2.047715614433876, 51.899275803299602 ], [ -2.047725039757862, 51.899459925020338 ], [ -2.04774146378091, 51.899715410185074 ], [ -2.047732345953417, 51.899819609240694 ], [ -2.047737010722866, 51.899866709547595 ], [ -2.047746347906446, 51.899968045441121 ], [ -2.047739495456686, 51.900033706189816 ], [ -2.047711917869112, 51.900136485069609 ], [ -2.047723515854956, 51.90019357335462 ], [ -2.047760634902552, 51.900383392935282 ], [ -2.047781491190947, 51.900467597181539 ], [ -2.047800050400597, 51.900561793596275 ], [ -2.047793152253961, 51.900584633793891 ], [ -2.047793268432413, 51.900693111161019 ], [ -2.047804908102665, 51.900788738210096 ], [ -2.04786049925112, 51.900989969840282 ], [ -2.047953113921345, 51.901289671721536 ], [ -2.047493939338546, 51.901275587632988 ], [ -2.046990922064887, 51.901258664887834 ], [ -2.046384077637767, 51.901243209431676 ], [ -2.046192928697391, 51.901238620410808 ], [ -2.046193333593705, 51.901250660209413 ], [ -2.046194082379715, 51.901271968778893 ], [ -2.045688746931509, 51.901295726046378 ], [ -2.045665057114494, 51.901296904239423 ], [ -2.045520737939592, 51.901303884244619 ], [ -2.045001595575354, 51.901329082570406 ], [ -2.044921078941378, 51.901332890122596 ], [ -2.044905963914343, 51.901333615278432 ], [ -2.044687377072586, 51.901343859862884 ], [ -2.044575758158369, 51.901349027854799 ], [ -2.044445678131443, 51.901351775244294 ], [ -2.04384685714295, 51.90134750831497 ], [ -2.043849555991651, 51.901369478808647 ], [ -2.043693684596166, 51.901367796246852 ], [ -2.043682059553277, 51.90137031814389 ], [ -2.043636588220248, 51.901392093744505 ], [ -2.043626489133372, 51.901412283443825 ], [ -2.04339575202412, 51.901408802626314 ], [ -2.043274624596464, 51.901417173781823 ], [ -2.043157371727356, 51.901455279587559 ], [ -2.043111276741362, 51.901508822527298 ], [ -2.0430767291372, 51.901574254555278 ], [ -2.043028698389376, 51.901614714355013 ], [ -2.042938343478862, 51.901631400352009 ], [ -2.042605694579685, 51.90162557587125 ], [ -2.042273048023322, 51.90162212949064 ], [ -2.042030775851215, 51.901622217885986 ], [ -2.041951950968416, 51.901632951327635 ], [ -2.041892378654616, 51.901668656776394 ], [ -2.041876989343963, 51.901555600324954 ], [ -2.041868712799041, 51.901471437749507 ], [ -2.041956817311655, 51.901468061099635 ], [ -2.041959603728276, 51.901448180791903 ], [ -2.041966577022094, 51.901398475523877 ], [ -2.041995020098401, 51.901258932490109 ], [ -2.041995728992697, 51.901255443690168 ], [ -2.041852638350245, 51.901240084889132 ], [ -2.041831125320988, 51.901237754997673 ], [ -2.041734357770506, 51.901100460106441 ], [ -2.041720953856821, 51.901081439803704 ], [ -2.041635327325281, 51.901076129988112 ], [ -2.041467591821809, 51.901065724693147 ], [ -2.041315205487592, 51.901056266725028 ], [ -2.041235509381453, 51.901051323131313 ], [ -2.041142208421074, 51.901045539168045 ], [ -2.041112803869573, 51.901043715456261 ], [ -2.041063239108313, 51.901040640153994 ], [ -2.040969095153992, 51.901034802406407 ], [ -2.040876404734432, 51.901029053979805 ], [ -2.040533434391598, 51.901007776078941 ], [ -2.04052776939527, 51.900931650505015 ], [ -2.040518514272084, 51.900807405872499 ], [ -2.04050224054736, 51.90058879320771 ], [ -2.040491499385141, 51.900444498952758 ], [ -2.040484098353523, 51.90034465612122 ], [ -2.040382253483124, 51.900339467987841 ], [ -2.040289696327322, 51.900334753051062 ], [ -2.040288743461969, 51.900341838317487 ], [ -2.040206462358129, 51.900337641209575 ], [ -2.040204744403834, 51.900350543940021 ], [ -2.040145500842156, 51.90034752558266 ], [ -2.040055665432633, 51.900343883943982 ], [ -2.040043633375111, 51.900347905310824 ], [ -2.0400465514026, 51.900384776524817 ], [ -2.040043696741988, 51.900418677305161 ], [ -2.040019689810884, 51.900448421702642 ], [ -2.039978368651064, 51.900468656083525 ], [ -2.039883216468938, 51.900494262353952 ], [ -2.039759222819303, 51.900521662316898 ], [ -2.039602540049148, 51.900545504804512 ], [ -2.03952756166834, 51.900555640986191 ], [ -2.03945643109424, 51.900568154848031 ], [ -2.039362238587175, 51.900593165161247 ], [ -2.039211347022776, 51.900643173729513 ], [ -2.039102745447753, 51.900681867779021 ], [ -2.039009526663647, 51.900720556530011 ], [ -2.038925595613747, 51.900754880496052 ], [ -2.038806439707152, 51.900817960778092 ], [ -2.038712287722347, 51.900890549624918 ], [ -2.0386354502529, 51.900975026017001 ], [ -2.038570151878278, 51.901061877544791 ], [ -2.03851635206542, 51.901105905120076 ], [ -2.03841641022114, 51.90115351661273 ], [ -2.038326062298928, 51.901180903866617 ], [ -2.038226085331189, 51.90118807327633 ], [ -2.038151086700827, 51.901176203794016 ], [ -2.038072230109369, 51.901150062177521 ], [ -2.038031823837896, 51.90111677070378 ], [ -2.03800870894628, 51.901068011535237 ], [ -2.038022493817329, 51.900981945147251 ], [ -2.03803476109196, 51.900938168864187 ], [ -2.038040238392491, 51.900922103570572 ], [ -2.038039637269773, 51.900893911296869 ], [ -2.03803648341612, 51.900865110268818 ], [ -2.038034802530014, 51.900854060769447 ], [ -2.03802726163471, 51.900834733304471 ], [ -2.038016078241171, 51.900815136407658 ], [ -2.038002415758201, 51.900794349905766 ], [ -2.037983395390988, 51.90077117083861 ], [ -2.037960109023108, 51.900749420058894 ], [ -2.037932202465523, 51.900748359300437 ], [ -2.037765324418213, 51.900718329867757 ], [ -2.037643436715566, 51.900696395486065 ], [ -2.03760953202007, 51.900683396435809 ], [ -2.037596977690968, 51.900687176789191 ], [ -2.037590386597591, 51.900678763273909 ], [ -2.037487031140266, 51.900709726284653 ], [ -2.037468420266356, 51.900735770542411 ], [ -2.03744408989816, 51.900787387326446 ], [ -2.037441768567236, 51.900792306208736 ], [ -2.037392286613321, 51.900783376128153 ], [ -2.037393505308467, 51.900780786297794 ], [ -2.037381004014003, 51.90077855156914 ], [ -2.03738013883144, 51.900769434880146 ], [ -2.037352008169577, 51.900726520513004 ], [ -2.037304459365195, 51.900665639225238 ], [ -2.037264863145046, 51.900676836951519 ], [ -2.037244450649546, 51.900651704447199 ], [ -2.037165986523647, 51.900676050678967 ], [ -2.037146544842038, 51.900682080978264 ], [ -2.03716587064845, 51.900728684583676 ], [ -2.037117158505833, 51.900736414636626 ], [ -2.037133076453188, 51.900774819466072 ], [ -2.037070107831107, 51.90078450515859 ], [ -2.036992301726819, 51.900796560237957 ], [ -2.036945972613232, 51.900803714025685 ], [ -2.036968925802983, 51.900860557357241 ], [ -2.036972435842417, 51.900869322548559 ], [ -2.036916074946722, 51.90087801522116 ], [ -2.036896431534859, 51.900881044316868 ], [ -2.036901703794435, 51.900894133662675 ], [ -2.036834433387828, 51.90090450393047 ], [ -2.036859891622296, 51.900967667221586 ], [ -2.036775283929332, 51.900980713354592 ], [ -2.03672645501082, 51.900988245480555 ], [ -2.03667667404577, 51.900995734732071 ], [ -2.03666516738216, 51.901045214588933 ], [ -2.036640258392011, 51.901154374398722 ], [ -2.036638375674877, 51.901162556893262 ], [ -2.036633307558728, 51.901185485795274 ], [ -2.036605775638173, 51.901286644356027 ], [ -2.036583325452475, 51.901381507529962 ], [ -2.03655942764702, 51.901483564033192 ], [ -2.036542785135066, 51.901571232479085 ], [ -2.036518878272489, 51.901662499662208 ], [ -2.036498607895334, 51.901757362124918 ], [ -2.036482663845085, 51.901810864182615 ], [ -2.036414488208815, 51.901977670539807 ], [ -2.03641601460615, 51.902066681881244 ], [ -2.03639205715888, 51.902096809616019 ], [ -2.036384071581404, 51.902107151896224 ], [ -2.036371041191968, 51.90216919455505 ], [ -2.036342010868844, 51.902216856513142 ], [ -2.036306418944109, 51.902238895917513 ], [ -2.036304999633978, 51.902280704947856 ], [ -2.0363348644697, 51.902364762248162 ], [ -2.036264363056957, 51.902354894269529 ], [ -2.036255509821448, 51.902388566003154 ], [ -2.036220789278223, 51.902384997575702 ], [ -2.036094353215852, 51.902379644421266 ], [ -2.036007102761918, 51.902370683344309 ], [ -2.035960602581888, 51.90236620322996 ], [ -2.035922850852657, 51.902363518586469 ], [ -2.035889414481939, 51.902362630804333 ], [ -2.035861732400261, 51.902363537640845 ], [ -2.035835610614006, 51.902367141313199 ], [ -2.035813801277126, 51.902368946318688 ], [ -2.035783244219057, 51.902371652249826 ], [ -2.035757120968379, 51.902375255905262 ], [ -2.035710629479072, 51.902381562304285 ], [ -2.035662698307387, 51.902388767341307 ], [ -2.035544908822628, 51.902404983248317 ], [ -2.035523094424233, 51.902400496234243 ], [ -2.035479467075278, 51.902393318614003 ], [ -2.035443152137452, 51.902387936944677 ], [ -2.035422776673353, 51.90238524588932 ], [ -2.035393774838187, 51.902384356601495 ], [ -2.035353028237497, 51.902382570906376 ], [ -2.035294902506671, 51.902378993208679 ], [ -2.035158272847204, 51.902361957347615 ], [ -2.035078337086014, 51.902359285313601 ], [ -2.035027401053009, 51.90235300886232 ], [ -2.03492418453703, 51.902308996461706 ], [ -2.034915550343389, 51.902302707114131 ], [ -2.034852962745177, 51.90226227785238 ], [ -2.034803550404674, 51.902213754384647 ], [ -2.034796238106015, 51.902210161057518 ], [ -2.034732232201995, 51.902195799141019 ], [ -2.034610228639732, 51.902185049429249 ], [ -2.034527313726315, 51.90220305213527 ], [ -2.034485258812789, 51.902213850516475 ], [ -2.034464891164609, 51.902221047721952 ], [ -2.034329752627065, 51.902272322246034 ], [ -2.034248414979388, 51.902315492155076 ], [ -2.034217868956419, 51.902332578967631 ], [ -2.034200383170186, 51.902346966343941 ], [ -2.03414229907313, 51.90239731941336 ], [ -2.034079923166042, 51.902474728833013 ], [ -2.034061004549454, 51.902497205902179 ], [ -2.03405083445785, 51.902517882149141 ], [ -2.03403636077949, 51.902552042719066 ], [ -2.034002956680566, 51.90259339998515 ], [ -2.033985474167067, 51.902612281076799 ], [ -2.033914335996305, 51.902674323628787 ], [ -2.03389984431307, 51.902685113635314 ], [ -2.033869297224957, 51.902701302146234 ], [ -2.033824257030156, 51.902726483327029 ], [ -2.033802454292109, 51.902737276379504 ], [ -2.033754532092875, 51.902757154537618 ], [ -2.033686241937354, 51.902780545195881 ], [ -2.033660124426986, 51.90279223770127 ], [ -2.033642634197522, 51.902801231237547 ], [ -2.033626702869736, 51.90280932610316 ], [ -2.033617956387132, 51.902812025100275 ], [ -2.033607783888915, 51.902831802199103 ], [ -2.033681973622722, 51.902842567017416 ], [ -2.033767677995467, 51.902866810539763 ], [ -2.033625430811568, 51.903029544437629 ], [ -2.033606575896907, 51.903134806007259 ], [ -2.033583545706826, 51.90342343404938 ], [ -2.033586471091219, 51.90348994839799 ], [ -2.033587920950004, 51.903504329225825 ], [ -2.033590806967971, 51.903516912312881 ], [ -2.033596696154563, 51.903539382023574 ], [ -2.033598141842563, 51.903550168213478 ], [ -2.033599586169464, 51.903559156185182 ], [ -2.033605465925957, 51.903567243746025 ], [ -2.033608347095305, 51.903575333085769 ], [ -2.033609791516345, 51.903582522838725 ], [ -2.033611234485015, 51.903589713491208 ], [ -2.033614116429144, 51.903596903721258 ], [ -2.033619997464112, 51.903608586818933 ], [ -2.0336214397539, 51.903614878362177 ], [ -2.033625879864937, 51.903622068134446 ], [ -2.033631641718265, 51.903633751266483 ], [ -2.033643275671659, 51.903647230891778 ], [ -2.033653474243239, 51.903661609147882 ], [ -2.033665112391847, 51.903678684307664 ], [ -2.033679627712772, 51.903698544060603 ], [ -2.033692704088666, 51.903716517903824 ], [ -2.033707337958746, 51.903733591278794 ], [ -2.033755330252784, 51.903806384313171 ], [ -2.033855803637358, 51.904020371424842 ], [ -2.03388199927385, 51.90411204674345 ], [ -2.033883461519642, 51.904144405250797 ], [ -2.033877763435217, 51.904214516773322 ], [ -2.033867615433778, 51.90426665372091 ], [ -2.033835664750638, 51.904328773625323 ], [ -2.033784911582034, 51.904408785945797 ], [ -2.033779045455764, 51.904416878759307 ], [ -2.03370484425151, 51.904394429185317 ], [ -2.033292015227989, 51.9042839010894 ], [ -2.033102983490082, 51.904235418397754 ], [ -2.033062347930265, 51.904222846210104 ], [ -2.032816621216135, 51.904161794589264 ], [ -2.032457544740616, 51.90413043717875 ], [ -2.032286057248654, 51.904143968747185 ], [ -2.031223605820255, 51.90426830492828 ], [ -2.030921239067344, 51.904270185370933 ], [ -2.030594264934877, 51.904214543929406 ], [ -2.029903640289061, 51.904096078658057 ], [ -2.029602759949661, 51.903989103770961 ], [ -2.029217481860042, 51.90383729770069 ], [ -2.028509363282439, 51.903522788739345 ], [ -2.028221555021263, 51.903419492490137 ], [ -2.028004942666247, 51.903328672074487 ], [ -2.027565810605083, 51.903088785373861 ], [ -2.027379654982932, 51.903019528754243 ], [ -2.027196497495897, 51.902955753891703 ], [ -2.02688978151831, 51.902885716949669 ], [ -2.026526366335131, 51.902789624572101 ], [ -2.025883809209778, 51.902635080967066 ], [ -2.025558152541068, 51.902547067173238 ], [ -2.025309663300756, 51.902440967692222 ], [ -2.025078422161393, 51.902319674319287 ], [ -2.024818179671909, 51.902192993081236 ], [ -2.024640746631213, 51.902066204288467 ], [ -2.024334134645414, 51.902166132804069 ], [ -2.023816898591132, 51.902366686573977 ], [ -2.023607559962729, 51.902405381325927 ], [ -2.023598812479554, 51.902407180469297 ], [ -2.02345057330619, 51.902413503242542 ], [ -2.023107600641559, 51.902427955953996 ], [ -2.022678831705444, 51.902464086253538 ], [ -2.022034954242192, 51.902507359230874 ], [ -2.020745750895015, 51.902578612720326 ], [ -2.019661471021177, 51.902656108373208 ], [ -2.01925750040558, 51.90268134623669 ], [ -2.018680481092827, 51.902707510787828 ], [ -2.018216831411449, 51.902740844295636 ], [ -2.017123771696677, 51.902753600254378 ], [ -2.016427516073826, 51.902799636359113 ], [ -2.015817055287179, 51.902817701126601 ], [ -2.014555493213775, 51.902820569329471 ], [ -2.013440627252624, 51.902857562566048 ], [ -2.011459551546606, 51.902900931807501 ], [ -2.010215369699301, 51.902924424887999 ] ] ] }";

                // Parse the JSON data directly
                dynamic jsonData = JsonConvert.DeserializeObject(stringResult);

                if (jsonData != null && jsonData.type == "Polygon")
                {
                    var coordinates = jsonData.coordinates[0]; // Extract coordinates array

                    var mapPolygon = new Microsoft.Maui.Controls.Maps.Polygon
                    {
                        StrokeWidth = 8,
                        StrokeColor = Color.Parse("#1BA1E2"), 
                        FillColor = new Color(0,0,0,0), 
                    };

                    foreach (var coordinate in coordinates)
                    {
                        double latitude = coordinate[1].Value;
                        double longitude = coordinate[0].Value;

                        mapPolygon.Geopath.Add(new Location(latitude, longitude));
                    }

                    map.MapElements.Add(mapPolygon);
                }

                else
                {
                    Console.WriteLine("Invalid GeoJSON format or no Polygon data found.");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error loading polygon from web: {ex.Message}");
                return;
            }
        }


        protected override async void OnAppearing()
        {
            base.OnAppearing();
            map.Focus();
            //UpdatePins();
            //var check =  await CheckPins();

            //if (check == false)
            //{
            //    Debug.WriteLine("PINSSS");
            //    UpdatePins();

            //}
           




        }


        protected override void OnDisappearing()
        {
            base.OnDisappearing();

        }
       







        private async Task<PermissionStatus> CheckAndRequestLocationPermission()
        {
            PermissionStatus status = await Permissions.CheckStatusAsync<Permissions.LocationWhenInUse>();

            if (status == PermissionStatus.Granted)
            {
                map.IsEnabled = true;


                return status;
            }

            else if (status == PermissionStatus.Denied && DeviceInfo.Platform == DevicePlatform.iOS)
            {
                // Prompt the user to turn on in settings
                // On iOS once a permission has been denied it may not be requested again from the application
                return status;
            }

            if (Permissions.ShouldShowRationale<Permissions.LocationWhenInUse>())
            {
                // Prompt the user with additional information as to why the permission is needed
            }

            status = await Permissions.RequestAsync<Permissions.LocationWhenInUse>();

            return status;
        }

    }
}